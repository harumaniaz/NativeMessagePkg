#!/bin/bash

# .appがインストールされた場所
APP_PATH="/Applications/NativeMessageApp.app"
JSON_SRC="$APP_PATH/Contents/Resources/com.my.nma.json"
JSON_DEST="/Library/Google/Chrome/NativeMessagingHosts/com.my.nma.json"

echo "[postinstall] Copying JSON from app to NativeMessagingHosts..."

if [ -f "$JSON_SRC" ]; then
    mkdir -p "$(dirname "$JSON_DEST")"
    cp "$JSON_SRC" "$JSON_DEST"
    chmod 777 "$JSON_DEST"
    echo "[postinstall] JSON successfully copied to: $JSON_DEST"
else
    echo "[postinstall] ERROR: JSON not found at $JSON_SRC"
    exit 1
fi

exit 0